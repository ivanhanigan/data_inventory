<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Data Inventory </title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="title" content="Data Inventory "/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2016-01-26T16:16+1100"/>
<meta name="author" content="Ivan Hanigan"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>

</head>
<body>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">Data Inventory </h1>


<hr/>






<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 Introduction</a></li>
<li><a href="#sec-2">2 The Ecological Metadata Language (EML)</a>
<ul>
<li><a href="#sec-2-1">2.1 XML</a></li>
<li><a href="#sec-2-2">2.2 A schematic diagram of the EML modules</a></li>
<li><a href="#sec-2-3">2.3 The parts of an EML document</a>
<ul>
<li><a href="#sec-2-3-1">2.3.1 Datasets</a></li>
<li><a href="#sec-2-3-2">2.3.2 Projects</a></li>
<li><a href="#sec-2-3-3">2.3.3 Data Entity</a></li>
<li><a href="#sec-2-3-4">2.3.4 Attributes</a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-3">3 web2py</a>
<ul>
<li><a href="#sec-3-1">3.1 set up web2py</a></li>
<li><a href="#sec-3-2">3.2 the web2py database example</a></li>
<li><a href="#sec-3-3">3.3 installer</a></li>
</ul>
</li>
<li><a href="#sec-4">4 Design the database</a>
<ul>
<li><a href="#sec-4-1">4.1 Create a new database</a></li>
<li><a href="#sec-4-2">4.2 Create a new web2py application</a></li>
<li><a href="#sec-4-3">4.3 relational model</a></li>
<li><a href="#sec-4-4">4.4 defaults for models/db.py</a></li>
</ul>
</li>
<li><a href="#sec-5">5 Define our tables</a>
<ul>
<li><a href="#sec-5-1">5.1 Project Information and Data Owners</a>
<ul>
<li><a href="#sec-5-1-1">5.1.1 eml/dataset/project/title</a></li>
<li><a href="#sec-5-1-2">5.1.2 eml/dataset/project/personnel</a></li>
<li><a href="#sec-5-1-3">5.1.3 eml/dataset/project/abstract</a></li>
<li><a href="#sec-5-1-4">5.1.4 eml/dataset/project/studyAreaDescription</a></li>
</ul>
</li>
<li><a href="#sec-5-2">5.2 Dataset</a>
<ul>
<li><a href="#sec-5-2-1">5.2.1 dataset shortname</a></li>
<li><a href="#sec-5-2-2">5.2.2 dataset title</a></li>
<li><a href="#sec-5-2-3">5.2.3 dataset creator</a></li>
<li><a href="#sec-5-2-4">5.2.4 dataset contact</a></li>
<li><a href="#sec-5-2-5">5.2.5 dataset abstract</a></li>
<li><a href="#sec-5-2-6">5.2.6 dataset additional metadata links</a></li>
<li><a href="#sec-5-2-7">5.2.7 dataset methods/studyextent</a></li>
<li><a href="#sec-5-2-8">5.2.8 dataset temporal coverage</a></li>
<li><a href="#sec-5-2-9">5.2.9 dataset methods protocol</a></li>
<li><a href="#sec-5-2-10">5.2.10 dataset sampling description</a></li>
<li><a href="#sec-5-2-11">5.2.11 dataset method steps</a></li>
<li><a href="#sec-5-2-12">5.2.12 dataset Geographic</a></li>
<li><a href="#sec-5-2-13">5.2.13 dataset bounding coords</a></li>
<li><a href="#sec-5-2-14">5.2.14 dataset taxo cov</a></li>
<li><a href="#sec-5-2-15">5.2.15 dataset additional info</a></li>
<li><a href="#sec-5-2-16">5.2.16 dataset alternateidentifier</a></li>
<li><a href="#sec-5-2-17">5.2.17 dataset pubdate</a></li>
<li><a href="#sec-5-2-18">5.2.18 access<sub>rules</sub> (ie ethics required)</a></li>
<li><a href="#sec-5-2-19">5.2.19 distribution<sub>method</sub></a></li>
<li><a href="#sec-5-2-20">5.2.20 metadataprovider</a></li>
</ul>
</li>
<li><a href="#sec-5-3">5.3 Data Entity (dataTable)</a>
<ul>
<li><a href="#sec-5-3-1">5.3.1 eml/dataset/entity/id</a></li>
<li><a href="#sec-5-3-2">5.3.2 eml/dataset/entity/name</a></li>
<li><a href="#sec-5-3-3">5.3.3 eml/dataset/entity/description</a></li>
<li><a href="#sec-5-3-4">5.3.4 eml/dataset/entity/physical/distribution</a></li>
<li><a href="#sec-5-3-5">5.3.5 temporal cov</a></li>
<li><a href="#sec-5-3-6">5.3.6 eml/dataset/entity methods</a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-6">6 Design User Interface</a>
<ul>
<li><a href="#sec-6-1">6.1 Defaults for controllers/default.py</a></li>
<li><a href="#sec-6-2">6.2 Top Menu</a></li>
<li><a href="#sec-6-3">6.3 Access a dataset</a></li>
<li><a href="#sec-6-4">6.4 Main form ties it all together (manage projects)</a></li>
<li><a href="#sec-6-5">6.5 Form to manage all dataset</a>
<ul>
<li><a href="#sec-6-5-1">6.5.1 manage datasets</a></li>
</ul>
</li>
<li><a href="#sec-6-6">6.6 test autoenter creator in contact FAIL</a>
<ul>
<li><a href="#sec-6-6-1">6.6.1 manage datasets test</a></li>
</ul>
</li>
<li><a href="#sec-6-7">6.7 Form to manage all publications</a></li>
<li><a href="#sec-6-8">6.8 Form to manage accessors or groups</a></li>
<li><a href="#sec-6-9">6.9 finesse the interface</a></li>
</ul>
</li>
<li><a href="#sec-7">7 backups</a></li>
<li><a href="#sec-8">8 ETL</a>
<ul>
<li><a href="#sec-8-1">8.1 summary of data for ETL</a></li>
<li><a href="#sec-8-2">8.2 load transformed</a></li>
<li><a href="#sec-8-3">8.3 summary of EML fields for projects/datasets</a>
<ul>
<li><a href="#sec-8-3-1">8.3.1 head</a></li>
<li><a href="#sec-8-3-2">8.3.2 dataset overview</a></li>
<li><a href="#sec-8-3-3">8.3.3 umbrella project</a></li>
<li><a href="#sec-8-3-4">8.3.4 dataset overview</a></li>
<li><a href="#sec-8-3-5">8.3.5 files entities overview</a></li>
<li><a href="#sec-8-3-6">8.3.6 attributes</a></li>
</ul>
</li>
<li><a href="#sec-8-4">8.4 short summary of EML fields for projects/datasets homepage</a>
<ul>
<li><a href="#sec-8-4-1">8.4.1 head</a></li>
<li><a href="#sec-8-4-2">8.4.2 dataset overview</a></li>
<li><a href="#sec-8-4-3">8.4.3 umbrella project</a></li>
<li><a href="#sec-8-4-4">8.4.4 dataset overview</a></li>
<li><a href="#sec-8-4-5">8.4.5 files entities overview</a></li>
</ul>
</li>
<li><a href="#sec-8-5">8.5 data inventory report</a></li>
</ul>
</li>
<li><a href="#sec-9">9 check in/check out</a>
<ul>
<li><a href="#sec-9-1">9.1 checkout from child to master when master not exists</a></li>
<li><a href="#sec-9-2">9.2 checkout from master to child, assumes you want to replace child (and manually removed it)</a></li>
<li><a href="#sec-9-3">9.3 DEPRECATED identify-aquire-post-update-review procedures</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">

<ul>
<li>There is a need for a data inventory tool to enable ecological data collections to be managed more efficiently
</li>
<li>The Ecological Metadata Language (EML) provides an excellent standardised schema for metadata, but the associated software Morpho does not have the flexibility or extensibility that would enable a data manager to use it to manage large and heterogeneous data collections
</li>
<li>This article describes an approach to use a relational database with web-based forms (using the web2py framework) and SQL helper functions (written in the R language) 
</li>
</ul>

</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> The Ecological Metadata Language (EML)</h2>
<div class="outline-text-2" id="text-2">

<p>The  Ecological Metadata Language (EML) schema is defined by the 'Knowledge Network for Biocomplexity' - KNB (<a href="https://knb.ecoinformatics.org/#tools/eml">https://knb.ecoinformatics.org/#tools/eml</a>).  KNB is a subproject of  Ecoinformatics.org (<a href="http://ecoinformatics.org/">http://ecoinformatics.org/</a>).  Ecoinformatics.org is an open, voluntary collaboration of developers and researchers that aims to produce software, systems, publications, and services that are beneficial to the ecological and environmental sciences. 
</p>


</div>

<div id="outline-container-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> XML</h3>
<div class="outline-text-3" id="text-2-1">

<p>A minimal EML document is summarised below.  This is a schematic view that shows the structure of an EML XML document.  Only a few of the possible components are included.  
</p>




<pre class="src src-R">&lt;eml&gt;
    &lt;dataset&gt;
        &lt;title&gt;
        &lt;creator&gt; 
        &lt;contact&gt; 
        &lt;project&gt; 
            &lt;title&gt; 
            &lt;personnel&gt;
                &lt;role&gt;
            &lt;abstract&gt;
            &lt;funding&gt;
            &lt;studyAreaDescription&gt;
            &lt;designDescription&gt;
            &lt;relatedProject&gt;
        &lt;associatedParty&gt;
        &lt;publisher&gt;
        &lt;pubDate&gt;
        &lt;keywords&gt;
        &lt;abstract&gt; 
        &lt;intellectualright&gt;
        &lt;methods&gt; 
        &lt;coverage&gt;
        &lt;dataTable&gt;
            &lt;entityName&gt;
            &lt;entityDescription&gt;                
            &lt;physical&gt;
            &lt;attribute&gt;
    &lt;additionalMetadata&gt;
        &lt;additionalLinks&gt;
  
</pre>

</div>

</div>

<div id="outline-container-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> A schematic diagram of the EML modules</h3>
<div class="outline-text-3" id="text-2-2">

<p>In the figure below the EML hierarchy of modules is shown graphically. An EML metadata document contains a dataset module that allows the grouping of one or more data entities linked together by particular integrity constraints to form a Data Package.  The project module places the dataset that is being documented into its larger research context, and optionally allows multiple related Data Packages to be linked. The mandatory component of the EML is shown as a firm line, in contrast with those aspects of the EML which are not mandatory (dotted lines).
</p>
<p>
<img src="./images/EML_project.png"  alt="./images/EML_project.png" />
</p>
</div>

</div>

<div id="outline-container-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> The parts of an EML document</h3>
<div class="outline-text-3" id="text-2-3">

<p>In EML, the term dataset is applied to a document which may contain
  general information such as the title, creator, and contacts,
  abstract and keywords as well as one or more data entities, such as
  datatables, that provide more specific research details.
</p>
<p>
The information is at the level of a particular data collection or
  study, however there is also a level above this at the "project"
  level where research studies can be grouped together.
</p>
<p>
In EML, the term dataset refers to one or more data
  entities.  However, there is no generally accepted practice on what to
  include in an EML-dataset document. Some people will choose to have
  a one-to-one correspondence between an EML document and a data
  entity and a single physical file. Others will document several data
  entities in one dataset document. 
</p>
<p>
 Below is a brief description of the way we interpret the components of an EML dataset
</p>

</div>

<div id="outline-container-2-3-1" class="outline-4">
<h4 id="sec-2-3-1"><span class="section-number-4">2.3.1</span> Datasets</h4>
<div class="outline-text-4" id="text-2-3-1">

<p>Dataset is the top level of the EML.  The miminum necessary to
produce a valid EML document is &lt;title&gt;, &lt;creator&gt;, &lt;contract&gt;. But
one can't tell very much with just a title and a name.  Our aim is to
create an EML document that contains enough information about the data
and research to make funding agencies happy and give other ecologists
something to work with.
</p>
<p>
Datasets may include one or more data entities such as data tables and spatial images along with associated metadata, but inclusion of data entities are not mandatory. The dataset module enables entities which are linked together to be grouped logically.  LTERN groups entities into a single dataset using a range of integrity constraints such as the use of a specific sampling structure or monitoring theme employed over a discrete temporal and geographic range.
In the context of the work undertaken by the LTERN Data Portal Team, the term dataset is sometimes used interchangeably with the term “data package”, however it should be recognised that these are not exactly the same.  The dataset module is a part of an EML document which forms the basis for a data package.  
</p>
<p>
In EML, the dataset tag contains general information about a dataset; at minimum this must comprise a title, one Data Creator and a contact (often the Data Creator and contact will be the same).  Additional information such as abstract, temporal coverage, keywords, geographic coverage and methods are used to provide context for the published or archived data packages. 
</p>
<p>
For more information about the general EML descriptions see:
<a href="https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/eml-resource.html">https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/eml-resource.html</a>
</p>
<p>
For more detailed information about the EML-dataset module see: <a href="https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/eml-dataset.html">https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/eml-dataset.html</a>
</p></div>

</div>

<div id="outline-container-2-3-2" class="outline-4">
<h4 id="sec-2-3-2"><span class="section-number-4">2.3.2</span> Projects</h4>
<div class="outline-text-4" id="text-2-3-2">

<p>The project module is optional, but in many cases highly desirable as
this provides an overall description of the larger-scale project or
research context with which that dataset is associated.  For example
it might be an entire Longterm Ecological Research Network (LTER)
site, or an individual project at an LTER site.
</p>
<p>
The EML “project” module of the EML enables data packages to be grouped logically together. The project module is primarily used by LTERN to identify the Data Owner and the source of funding.
The project module is recursive in that it provides an overall description of the larger-scale project or research context for the specific project with which that data package is associated.  Information in the project tag of the EML include detailed descriptions of the aims and objectives of the research, funding sources, personnel and a description of the study area.  This module also includes content on the study and sampling design and the methods employed during the research.  As an example, a project might comprise an entire Long Term Ecological Research Network (LTERN) plot network or an individual project at an LTERN site.
</p>
<p>
For more information about the EML-dataset module see:
<a href="https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/eml-project.html">https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/eml-project.html</a>
</p>
</div>

</div>

<div id="outline-container-2-3-3" class="outline-4">
<h4 id="sec-2-3-3"><span class="section-number-4">2.3.3</span> Data Entity</h4>
<div class="outline-text-4" id="text-2-3-3">

<p>As stated earlier, a dataset consists of one or more data entities,
and the most common data entity is a &lt;dataTable&gt;. A data table is
something that looks like a matrix with rows for observations and
columns for variables
</p>
<p>
In addition to datatables, people using database applications may also
  produce a &lt;view&gt; from a database management system or a
  &lt;storedProcedure&gt; that results in data output. People using GIS
  (geographical information system) applications generate both
  &lt;spatialVector&gt;, also referred to as boundary or shape files, and
  &lt;spatialRaster&gt;. A &lt;spatialRaster&gt; is a geo-referenced image usually
  produced by a camera on a satellite or other remote sensing
  device. The final kind of data entity is &lt;otherEntity&gt;. An
  &lt;otherEntity&gt; is a data entity that cannot be represented by any of
  the previously defined data entity structures. A non-geo-referenced
  photograph is an &lt;otherEntity&gt;, e.g., a photograph of two different
  types of butterflies.
</p>
<p>
For more information about types of EML-entities see: <a href="https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/#N10115">https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/#N10115</a>
</p>
</div>

</div>

<div id="outline-container-2-3-4" class="outline-4">
<h4 id="sec-2-3-4"><span class="section-number-4">2.3.4</span> Attributes</h4>
<div class="outline-text-4" id="text-2-3-4">

<p>An attribute or as it is sometime referred to, variable, in this
  context refers to the name of the column of a datatable
</p>
<p>
For more information about the EML dataTable type (especially its attributes) see:
<a href="https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/eml-dataTable.html#attribute">https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/eml-dataTable.html#attribute</a>
</p>


</div>
</div>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> web2py</h2>
<div class="outline-text-2" id="text-3">


</div>

<div id="outline-container-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> set up web2py</h3>
<div class="outline-text-3" id="text-3-1">

<ul>
<li>Web2py comes packaged up with everything it needs to run on a system (just needs python)
</li>
<li>run this using:
</li>
</ul>




<pre class="src src-sh"><span style="color: #586e75;">#### </span><span style="color: #586e75;">Code:</span>
    python ~/tools/web2py/web2py.py -a xpassword -i 0.0.0.0 -p 8181
</pre>


</div>

</div>

<div id="outline-container-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> the web2py database example</h3>
<div class="outline-text-3" id="text-3-2">

<ul>
<li>once the web server is running the example can be visited at this link:
</li>
<li><a href="http://127.0.0.1:8181/examples/default/examples#database\_examples">http://127.0.0.1:8181/examples/default/examples#database_examples</a>
</li>
<li>The default configuration of web2py uses the SQLite database engine
</li>
<li>Our implementation also utilises the PostgreSQL database which should be installed separately
</li>
</ul>

</div>

</div>

<div id="outline-container-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> installer</h3>
<div class="outline-text-3" id="text-3-3">



</div>
</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Design the database</h2>
<div class="outline-text-2" id="text-4">


</div>

<div id="outline-container-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> Create a new database</h3>
<div class="outline-text-3" id="text-4-1">

<ul>
<li>create a new postgres database using the following  code
</li>
</ul>




<pre class="src src-sh">sudo su
su - postgres 
createdb data_inventory
psql -d data_inventory
CREATE ROLE w2p_user LOGIN PASSWORD <span style="color: #2aa198;">'xpassword'</span>;
grant all on schema public to w2p_user;
\q
</pre>

</div>

</div>

<div id="outline-container-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> Create a new web2py application</h3>
<div class="outline-text-3" id="text-4-2">

<ul>
<li>this will create a directory in the applications folder of the web2py home directory
</li>
</ul>




<pre class="src src-sh"><span style="color: #268bd2; font-style: italic;">cd</span> ~/tools/web2py 
python ./web2py.py -S data_inventory
</pre>


</div>

</div>

<div id="outline-container-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> relational model</h3>
<div class="outline-text-3" id="text-4-3">

<ul>
<li>The structure we decided on was that there would be ONE project TO MANY datasets, ONE dataset to MANY datatables, and ONE datatable TO MANY attributes/variables
</li>
</ul>

</div>

</div>

<div id="outline-container-4-4" class="outline-3">
<h3 id="sec-4-4"><span class="section-number-3">4.4</span> defaults for models/db.py</h3>
<div class="outline-text-3" id="text-4-4">

<ul>
<li>the database tables are set up in the models/db.py file that comes with default settings
</li>
<li>The first bit to change is the db reference from SQLite to postgres
</li>
<li>also note that "#if request.is_local else []" will allow using as a server
</li>
<li>Then add new table definitions down the bottom.  
</li>
<li>Here we added projects, datasets, datatables and attributes.
</li>
</ul>



</div>
</div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Define our tables</h2>
<div class="outline-text-2" id="text-5">

<p>The following sections show the definitions LTERN used to create the data inventory
</p>
</div>

<div id="outline-container-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> Project Information and Data Owners</h3>
<div class="outline-text-3" id="text-5-1">

<ul>
<li>The EML Project module is used to place the dataset that is being documented into its larger research context.
</li>
<li>The KNB definition can be found at these links: <a href="./eml-2.1.1/docs/eml-2.1.1/eml-project.html">EML 2.1.1 definition</a> or <a href="https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/eml-project.html">EML online</a>
</li>
<li>The KNB says this is for 'Research context information for resources': The eml-project module describes the research context in which the dataset was created, including descriptions of over-all motivations and goals, funding, personnel, description of the study area etc. This is also the module to describe the design of the project: the scientific questions being asked, the architecture of the design, etc. 
</li>
<li>Morpho says: this metadata element is to recognise that data may be collected as part of a larger research program  (umbrella research project).  For example a large NSF grant may provide funds for several investigators to collect data at various locations.
</li>
<li>The new KNB metacat skin uses the title "Parent Project Information".
</li>
<li>Please also note the <a href="https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/eml-project.html#relatedProject">'relatedProject'</a> tag which LTERN is not currently using.  This 'is a recursive link to another project. This allows projects to be nested under one another for the case where one project spawns another.'
</li>
</ul>




</div>

<div id="outline-container-5-1-1" class="outline-4">
<h4 id="sec-5-1-1"><span class="section-number-4">5.1.1</span> eml/dataset/project/title</h4>
<div class="outline-text-4" id="text-5-1-1">

<p>LTERN's suggested structure is either:
</p><ul>
<li>the [Plot Network Name] (ie 'Victorian Alpine Plot Network') , or 
</li>
<li>a label that describes the [geographic coverage], [data type] and links to the [people] or [organisations] who own the data (ie Australian Tundra Experiment : Long Term Ecological Research Network (LTERN) - Victorian Alpine Plot Network).
</li>
<li>The KNB definition can be found at these links: <a href="./eml-2.1.1/docs/eml-2.1.1/eml-project.html#title">EML 2.1.1 definition</a> or <a href="https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/eml-project.html#title">EML online</a>
</li>
<li>If the data has been collected as part of a larger umbrella research project this is the title. Suggested structure is: [Generic Project Name] OR [geographic coverage] [data type].  Otherwise it is the same as the dataset title.
</li>
</ul>


</div>

</div>

<div id="outline-container-5-1-2" class="outline-4">
<h4 id="sec-5-1-2"><span class="section-number-4">5.1.2</span> eml/dataset/project/personnel</h4>
<div class="outline-text-4" id="text-5-1-2">

<p>In EML the Data Owner is able to be shown at various points on the xpath.  
LTERN uses the dataset/project/personnel/individualName or dataset/project/personnel/organizationName with  dataset/project/personnel/role == 'Data Owner' 
</p><ul>
<li>A data owner can be a person, an organisational role or an organisation who has a statutory and operational authority over data.
</li>
<li>Also , organisational roles or organisations , such as the originator
</li>
<li>The KNB definition can be found at these links: <a href="./eml-2.1.1/docs/eml-2.1.1/eml-project.html#personnel">EML 2.1.1 definition</a> or <a href="https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/eml-project.html#personnel">EML online</a>
</li>
</ul>



<ul>
<li id="sec-5-1-2-1">personnel general<br/>



<pre class="src src-markdown">Field('personnel','string', 
comment= XML(T('This is for key people etc that are not the owner. %s',
A('More', _href=XML(URL('static','index.html',  anchor='sec-5-1-2', scheme=True, host=True)))))
),
</pre>


</li>
</ul>
</div>

</div>

<div id="outline-container-5-1-3" class="outline-4">
<h4 id="sec-5-1-3"><span class="section-number-4">5.1.3</span> eml/dataset/project/abstract</h4>
<div class="outline-text-4" id="text-5-1-3">

<p>The following information is used to create the LTERN Data Portal record for each Data Package:
Complete this section of the contextual metadata last. In that way you can collate the key facts from the rest of the metadata elements – the ‘quick touch’ approach.
We use the informative abstract method. The eml/dataset/project/abstract should be a descriptive of the umbrella project, not the dataset.
</p><ul>
<li>Briefly outline the relevant project or study including the Plot Network name and describe the contents of the data package. 
</li>
<li>Include geographic location, the primary objectives of the study, what data was collected (species or phenomena), the year range the data was collected in, and collection frequency if applicable.
</li>
<li>Describe methodology techniques or approaches only to the degree necessary for comprehension – don’t go into any detail.
</li>
<li>Cite references and/or links to any publications that are related to the data package.
</li>
<li>Single paragraph. 200-250 words.
</li>
<li>Use active voice and past tense.
</li>
<li>Use short complete sentences.
</li>
<li>Express terms in both their abbreviated and spelled out form for search retrieval purposes.
</li>
<li>The KNB definition can be found at these links: <a href="./eml-2.1.1/docs/eml-2.1.1/eml-project.html#abstract">EML 2.1.1 definition</a> or <a href="https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/eml-project.html#abstract">EML online</a>
</li>
</ul>


</div>

</div>

<div id="outline-container-5-1-4" class="outline-4">
<h4 id="sec-5-1-4"><span class="section-number-4">5.1.4</span> eml/dataset/project/studyAreaDescription</h4>
<div class="outline-text-4" id="text-5-1-4">

<ul>
<li>The KNB definition can be found at these links: <a href="./eml-2.1.1/docs/eml-2.1.1/eml-project.html#studyAreaDescription">EML 2.1.1 definition</a> or <a href="https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/eml-project.html#studyAreaDescription">EML online</a>
</li>
</ul>










</div>
</div>

</div>

<div id="outline-container-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> Dataset</h3>
<div class="outline-text-3" id="text-5-2">



</div>

<div id="outline-container-5-2-1" class="outline-4">
<h4 id="sec-5-2-1"><span class="section-number-4">5.2.1</span> dataset shortname</h4>
<div class="outline-text-4" id="text-5-2-1">

<p>TODO
</p>
</div>

</div>

<div id="outline-container-5-2-2" class="outline-4">
<h4 id="sec-5-2-2"><span class="section-number-4">5.2.2</span> dataset title</h4>
<div class="outline-text-4" id="text-5-2-2">

<p>TODO
</p>
</div>

</div>

<div id="outline-container-5-2-3" class="outline-4">
<h4 id="sec-5-2-3"><span class="section-number-4">5.2.3</span> dataset creator</h4>
<div class="outline-text-4" id="text-5-2-3">

<p>TODO
</p>
</div>

</div>

<div id="outline-container-5-2-4" class="outline-4">
<h4 id="sec-5-2-4"><span class="section-number-4">5.2.4</span> dataset contact</h4>
<div class="outline-text-4" id="text-5-2-4">

<p>TODO
</p>
</div>

</div>

<div id="outline-container-5-2-5" class="outline-4">
<h4 id="sec-5-2-5"><span class="section-number-4">5.2.5</span> dataset abstract</h4>
<div class="outline-text-4" id="text-5-2-5">

<p>This should be brief but include:
</p><ul>
<li>Study research question
</li>
<li>Specific hypothesis under study
</li>
<li>Endpoints or outcomes of interest
</li>
</ul>



</div>

</div>

<div id="outline-container-5-2-6" class="outline-4">
<h4 id="sec-5-2-6"><span class="section-number-4">5.2.6</span> dataset additional metadata links</h4>
<div class="outline-text-4" id="text-5-2-6">

<p>TODO
</p>
</div>

</div>

<div id="outline-container-5-2-7" class="outline-4">
<h4 id="sec-5-2-7"><span class="section-number-4">5.2.7</span> dataset methods/studyextent</h4>
<div class="outline-text-4" id="text-5-2-7">

<ul>
<li><a href="http://127.0.0.1:8181/data_inventory/static/eml-2.1.1/docs/eml-2.1.1/eml-methods.html#studyExtent">http://127.0.0.1:8181/data_inventory/static/eml-2.1.1/docs/eml-2.1.1/eml-methods.html#studyExtent</a>
</li>
<li>Both specific to sampling area and frequency, spatial extent/resolution, temporal boundaries. eg CCD 2001.
</li>
</ul>


</div>

</div>

<div id="outline-container-5-2-8" class="outline-4">
<h4 id="sec-5-2-8"><span class="section-number-4">5.2.8</span> dataset temporal coverage</h4>
<div class="outline-text-4" id="text-5-2-8">



</div>

</div>

<div id="outline-container-5-2-9" class="outline-4">
<h4 id="sec-5-2-9"><span class="section-number-4">5.2.9</span> dataset methods protocol</h4>
<div class="outline-text-4" id="text-5-2-9">

<ul>
<li id="sec-5-2-9-1">general EML methods module info<br/>
<ul>
<li><a href="http://127.0.0.1:8181/data_inventory/static/eml-2.1.1/docs/eml-2.1.1/eml-methods.html">http://127.0.0.1:8181/data_inventory/static/eml-2.1.1/docs/eml-2.1.1/eml-methods.html</a>
</li>
<li>The eml-methods module describes the methods followed in the creation of the dataset, including description of field, laboratory and processing steps, sampling methods and units, quality control procedures. The eml-methods module is used to describe the actual procedures that are used in the creation or the subsequent processing of a dataset. Likewise, eml-methods is used to describe processes that have been used to define / improve the quality of a data file, or to identify potential problems with the data file. Note that the eml-protocol module is intended to be used to document a prescribed procedure, whereas the eml-method module is used to describe procedures that were actually performed. The distinction is that the use of the term "protocol" is used in the "prescriptive" sense, and the term "method" is used in the "descriptive" sense. This distinction allows managers to build a protocol library of well-known, established protocols (procedures), but also document what procedure was truly performed in relation to the established protocol. The method may have diverged from the protocol purposefully, or perhaps incidentally, but the procedural lineage is still preserved and understandable. 

</li>
<li>eml-methods is descriptive (often written in the declarative mood: "I took five subsamples&hellip;") whereas eml-protocol is prescriptive (often written in the imperative mood: "Take five subsamples&hellip;").
</li>
</ul>


</li>
</ul>
<ul>
<li id="sec-5-2-9-2">Recommendations for protocol<br/>
The protocol information can be captured in two places of EML
<ul>
<li><a href="http://127.0.0.1:8181/data_inventory/static/eml-2.1.1/docs/eml-2.1.1/eml-protocol.html">http://127.0.0.1:8181/data_inventory/static/eml-2.1.1/docs/eml-2.1.1/eml-protocol.html</a>
</li>
<li><a href="http://127.0.0.1:8181/data_inventory/static/eml-2.1.1/docs/eml-2.1.1/eml-methods.html#protocol">http://127.0.0.1:8181/data_inventory/static/eml-2.1.1/docs/eml-2.1.1/eml-methods.html#protocol</a>
</li>
<li>In many cases the simpler option is to use the methods module protocol section which is designed to capture 'reference a protocol resource or describe methods and identify the processes that have been used to define / improve the quality of a data file'.
</li>
<li>It can also be used to identify potential problems with the data collection protocol or study design, to be addressed in the methods steps.
</li>
</ul>



<p>
After deciding where the protocol information will sit, then consider including the following information:
</p><ul>
<li>Study type: select from a list like time-series, cross-sectional, spatial, exploratory, confirmatory
</li>
<li>Data sets collected/used 
</li>
<li>Analysis package (statistical package name and version)
</li>
<li>Study population (including inclusion and exclusion criteria)
</li>
<li>Exposure variables
</li>
<li>Outcome measures (outcome measures, including comparison group)
</li>
<li>Covariates (possible exposures, potential confounders or effect modifiers)
</li>
</ul>


<p>
If possible also details of the sequence of planned analyses, with statistical methods to be employed and how each of the planned hypotheses will be tested. Include details of how potential confounding and bias will be dealt with. For example:
</p>
<ol>
<li>Descriptive analyses
</li>
<li>Univariable analysis
</li>
<li>Multivariable analysis, and
</li>
<li>Interactions, subgroups, sensitivity analyses
</li>
</ol>


</li>
</ul>
</div>

</div>

<div id="outline-container-5-2-10" class="outline-4">
<h4 id="sec-5-2-10"><span class="section-number-4">5.2.10</span> dataset sampling description</h4>
<div class="outline-text-4" id="text-5-2-10">

<ul>
<li>Similar to a description of sampling procedures found in the methods section of a journal article.
</li>
<li><a href="http://127.0.0.1:8181/data_inventory/static/eml-2.1.1/docs/eml-2.1.1/eml-methods.html#samplingDescription">http://127.0.0.1:8181/data_inventory/static/eml-2.1.1/docs/eml-2.1.1/eml-methods.html#samplingDescription</a>
</li>
</ul>

</div>

</div>

<div id="outline-container-5-2-11" class="outline-4">
<h4 id="sec-5-2-11"><span class="section-number-4">5.2.11</span> dataset method steps</h4>
<div class="outline-text-4" id="text-5-2-11">

<ul>
<li><a href="http://127.0.0.1:8181/data_inventory/static/eml-2.1.1/docs/eml-2.1.1/eml-methods.html#methodStep">http://127.0.0.1:8181/data_inventory/static/eml-2.1.1/docs/eml-2.1.1/eml-methods.html#methodStep</a>
</li>
<li>EACH method step to implement the measurement protocols and set up the study. Note that the method is used to describe procedures that were actually performed. The method may have diverged from the protocol purposefully, or perhaps incidentally, but the procedural lineage is still preserved and understandable.
</li>
<li>Include data cleaning strategy, and process for handling missing data.
</li>
<li>Include text descriptions of the procedures, relevant literature, software, instrumentation, source data and any quality control measures taken.
</li>
</ul>





</div>

</div>

<div id="outline-container-5-2-12" class="outline-4">
<h4 id="sec-5-2-12"><span class="section-number-4">5.2.12</span> <span class="todo TODO">TODO</span> dataset Geographic</h4>
<div class="outline-text-4" id="text-5-2-12">




<pre class="src src-markdown">Field('geographicdescription','string',
comment = XML(T('A general description of the geographic area in which the data were collected. This can be a simple place name (e.g. Kakadu National Park). %s',
A('More', _href=XML(URL('static','index.html',  anchor='sec-5-2', scheme=True, host=True)))))     
),
</pre>

</div>

</div>

<div id="outline-container-5-2-13" class="outline-4">
<h4 id="sec-5-2-13"><span class="section-number-4">5.2.13</span> <span class="todo TODO">TODO</span> dataset bounding coords</h4>
<div class="outline-text-4" id="text-5-2-13">




<pre class="src src-markdown">Field('boundingcoordinates','string',
comment = XML(T('bounding coordinates in order N, S, E, W (Optionally also add altitudeMinimum, altitudeMax). %s',
A('More', _href=XML(URL('static','index.html',  anchor='sec-5-2', scheme=True, host=True)))))     
),
</pre>

</div>

</div>

<div id="outline-container-5-2-14" class="outline-4">
<h4 id="sec-5-2-14"><span class="section-number-4">5.2.14</span> <span class="todo TODO">TODO</span> dataset taxo cov</h4>
<div class="outline-text-4" id="text-5-2-14">




<pre class="src src-markdown">Field('taxonomic_coverage','string', comment="List of scientific names."),
</pre>

</div>

</div>

<div id="outline-container-5-2-15" class="outline-4">
<h4 id="sec-5-2-15"><span class="section-number-4">5.2.15</span> <span class="todo TODO">TODO</span> dataset additional info</h4>
<div class="outline-text-4" id="text-5-2-15">




<pre class="src src-markdown">  Field('additionalinfo','string', comment = XML(T('Any information that is not characterised well by EML metadata. Example is a group id for grouping datasets apart from EML-project (such as a funding stream, or a particular journal paper). %s.',
A('More', _href=XML(URL('static','index.html',  anchor='sec-5-2', scheme=True, host=True)))))
  ),
</pre>

</div>

</div>

<div id="outline-container-5-2-16" class="outline-4">
<h4 id="sec-5-2-16"><span class="section-number-4">5.2.16</span> <span class="todo TODO">TODO</span> dataset alternateidentifier</h4>
<div class="outline-text-4" id="text-5-2-16">




<pre class="src src-markdown">Field('alternateidentifier','string',
comment = XML(T('Additional identifier that is used to label this dataset. This might be a DOI, or other persistent URL. %s.',
A('More', _href=XML(URL('static','index.html',  anchor='sec-5-2', scheme=True, host=True)))))     
),
</pre>

</div>

</div>

<div id="outline-container-5-2-17" class="outline-4">
<h4 id="sec-5-2-17"><span class="section-number-4">5.2.17</span> <span class="todo TODO">TODO</span> dataset pubdate</h4>
<div class="outline-text-4" id="text-5-2-17">




<pre class="src src-markdown">Field('pubdate','date'),
</pre>

</div>

</div>

<div id="outline-container-5-2-18" class="outline-4">
<h4 id="sec-5-2-18"><span class="section-number-4">5.2.18</span> <span class="todo TODO">TODO</span> access<sub>rules</sub> (ie ethics required)</h4>
<div class="outline-text-4" id="text-5-2-18">





<pre class="src src-markdown">Field('access_rules','text', comment = "The eml-access module describes the level of access that is to be allowed or denied to a resource for a particular user or group of users"),
</pre>

</div>

</div>

<div id="outline-container-5-2-19" class="outline-4">
<h4 id="sec-5-2-19"><span class="section-number-4">5.2.19</span> <span class="todo TODO">TODO</span> distribution<sub>method</sub></h4>
<div class="outline-text-4" id="text-5-2-19">

<ul>
<li id="sec-5-2-19-1">ideas<br/>
new field = dataset/distribution<sub>methods</sub>
The methods of distribution used for others to access the software, data, and documentation.

<p>
Distribution strategies include:
</p><ul>
<li>publication of journal papers, reports, conference presentations, blogging, twitter and news media
</li>
<li>data deposit in a portal or archive
</li>
<li>code publication online to open-source code sharing sites, or made available on request.
</li>
</ul>


<p>
This deals with IP and copyright, so maybe just have well been in the intellectual<sub>right</sub> module?
</p></li>
</ul>
<ul>
<li id="sec-5-2-19-2">code<br/>



<pre class="src src-markdown">Field('distribution_methods','text', comment = "The methods of distribution used for others to access the software, data, and documentation."),
</pre>

</li>
</ul>
</div>

</div>

<div id="outline-container-5-2-20" class="outline-4">
<h4 id="sec-5-2-20"><span class="section-number-4">5.2.20</span> <span class="todo TODO">TODO</span> metadataprovider</h4>
<div class="outline-text-4" id="text-5-2-20">




<pre class="src src-markdown">Field('metadataprovider','string', comment = 'The name of the person who produced the metadata.'),
</pre>





</div>
</div>

</div>

<div id="outline-container-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> Data Entity (dataTable)</h3>
<div class="outline-text-3" id="text-5-3">

<ul>
<li>The entity level is for data files, tables, shapefiles, photos etc.  
</li>
<li>I also use this for folders
</li>
<li><a href="https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/#N10115">https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/#N10115</a>
</li>
<li><a href="https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/eml-dataTable.html#numberOfRecords">https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/eml-dataTable.html#numberOfRecords</a>
</li>
</ul>



</div>

<div id="outline-container-5-3-1" class="outline-4">
<h4 id="sec-5-3-1"><span class="section-number-4">5.3.1</span> eml/dataset/entity/id</h4>
<div class="outline-text-4" id="text-5-3-1">


</div>

</div>

<div id="outline-container-5-3-2" class="outline-4">
<h4 id="sec-5-3-2"><span class="section-number-4">5.3.2</span> eml/dataset/entity/name</h4>
<div class="outline-text-4" id="text-5-3-2">




<pre class="src src-markdown">Field('entityname','string', comment = "The file name, name of database table, etc. It should identify the entity in the dataset. Example: SpeciesAbundance1996.csv", requires = IS<span style="color: #268bd2; font-style: italic;">_NOT_</span>EMPTY()),
</pre>

</div>

</div>

<div id="outline-container-5-3-3" class="outline-4">
<h4 id="sec-5-3-3"><span class="section-number-4">5.3.3</span> eml/dataset/entity/description</h4>
<div class="outline-text-4" id="text-5-3-3">




<pre class="src src-markdown">Field('entitydescription', 'string', comment = "Text generally describing the entity, its type, and relevant information about the data in the entity. Example: Species abundance data for 1996 at the VCR LTER site"),
</pre>


</div>

</div>

<div id="outline-container-5-3-4" class="outline-4">
<h4 id="sec-5-3-4"><span class="section-number-4">5.3.4</span> eml/dataset/entity/physical/distribution</h4>
<div class="outline-text-4" id="text-5-3-4">

<ul>
<li>The PhysicalDistribution contains the information required for retrieving the resource.
</li>
<li>The KNB definition can be found at these links: <a href="./eml-2.1.1/docs/eml-2.1.1/eml-physical.html#distribution">EML 2.1.1 definition</a> or <a href="https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/eml-physical.html#distribution">EML online</a>
</li>
</ul>



</div>

</div>

<div id="outline-container-5-3-5" class="outline-4">
<h4 id="sec-5-3-5"><span class="section-number-4">5.3.5</span> <span class="todo TODO">TODO</span> temporal cov</h4>
<div class="outline-text-4" id="text-5-3-5">




<pre class="src src-markdown">Field('entity<span style="color: #268bd2; font-style: italic;">_temporalcoverage_</span>daterange','string', comment = "A text description of the temporal range that events were observed on"),
</pre>


</div>

</div>

<div id="outline-container-5-3-6" class="outline-4">
<h4 id="sec-5-3-6"><span class="section-number-4">5.3.6</span> eml/dataset/entity methods</h4>
<div class="outline-text-4" id="text-5-3-6">




<pre class="src src-markdown">Field('entity_methods', 'text', comment = "Information on the specific methods used to collect information in this entity."),
</pre>















</div>
</div>
</div>

</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Design User Interface</h2>
<div class="outline-text-2" id="text-6">


</div>

<div id="outline-container-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> Defaults for controllers/default.py</h3>
<div class="outline-text-3" id="text-6-1">

<ul>
<li>Following the example in the documentation 
</li>
</ul>



</div>

</div>

<div id="outline-container-6-2" class="outline-3">
<h3 id="sec-6-2"><span class="section-number-3">6.2</span> Top Menu</h3>
<div class="outline-text-3" id="text-6-2">

<ul>
<li>From example 30 we get a simple user registration form. SQLFORM takes a table and returns the corresponding entry form with validators, etc. 
</li>
<li>The response.menu on top is just a variable used by the layout to make the navigation menu for all functions in this controller.
</li>
</ul>




<pre class="src src-R">response.menu = [[<span style="color: #2aa198;">'Inventory Home'</span>, False, URL(<span style="color: #2aa198;">'data_inventory'</span>,<span style="color: #2aa198;">'default'</span>,<span style="color: #2aa198;">'index'</span>)],
                 [<span style="color: #2aa198;">'Manage Projects'</span>, False, URL(<span style="color: #2aa198;">'manage_projects'</span>)],
                 [<span style="color: #2aa198;">'Manage Datasets'</span>, False, URL(<span style="color: #2aa198;">'manage_datasets'</span>)],
                 [<span style="color: #2aa198;">'Manage Accessors or Groups'</span>, False, URL(<span style="color: #2aa198;">'manage_accessors_or_groups'</span>)],
                 [<span style="color: #2aa198;">'Set Access to a Dataset'</span>, False, URL(<span style="color: #2aa198;">'access_dataset'</span>)],
                 [<span style="color: #2aa198;">'Documentation'</span>, False, XML(URL(<span style="color: #2aa198;">'static'</span>,<span style="color: #2aa198;">'index.html'</span>, scheme=True, host=True))]]
</pre>



</div>

</div>

<div id="outline-container-6-3" class="outline-3">
<h3 id="sec-6-3"><span class="section-number-3">6.3</span> Access a dataset</h3>
<div class="outline-text-3" id="text-6-3">

<ul>
<li>Modified Example 32 from a sophisticated form that  checks the accessor  and the dataset are in the database and updates the corresponding record or inserts a new access. This version just adds another access record for each request.
</li>
<li>removed           
</li>
<li>title=form.vars.title
</li>
</ul>




<pre class="src src-R">def access_dataset():
    form = SQLFORM.factory(
        Field(<span style="color: #2aa198;">'accessdataset_id'</span>,requires=IS_IN_DB(db,db.accessdataset.id,<span style="color: #2aa198;">'%(name)s'</span>)),
        Field(<span style="color: #2aa198;">'dataset_id'</span>,requires=IS_IN_DB(db,db.dataset.id,<span style="color: #2aa198;">'%(shortname)s'</span>)),
        Field(<span style="color: #2aa198;">'title'</span>,<span style="color: #2aa198;">'string'</span>,requires=IS_NOT_EMPTY()),
        Field(<span style="color: #2aa198;">'description'</span>,<span style="color: #2aa198;">'text'</span>,requires=IS_NOT_EMPTY()),
        Field(<span style="color: #2aa198;">'begin_date'</span>,<span style="color: #2aa198;">'date'</span>),
        Field(<span style="color: #2aa198;">'end_date'</span>,<span style="color: #2aa198;">'date'</span>)).process()

    
    <span style="color: #859900; font-weight: bold;">if</span> form.accepted:
        <span style="color: #586e75;"># </span><span style="color: #586e75;">get previous access for same dataset</span>
        access = db((db.accessrequest.accessdataset_id == form.vars.accessdataset_id)&amp;
            (db.accessrequest.dataset_id==form.vars.dataset_id)).select().first()

        db.accessrequest.insert(accessdataset_id=form.vars.accessdataset_id,
                         dataset_id=form.vars.dataset_id,
                         title=form.vars.title,
                         description=form.vars.description,
                         begin_date =form.vars.begin_date,
                         end_date   =form.vars.end_date
                         )

        response.flash = <span style="color: #2aa198;">'dataset accessed!'</span>
    elif form.errors:
        response.flash = <span style="color: #2aa198;">'invalid values in form!'</span>

    
    <span style="color: #586e75;"># </span><span style="color: #586e75;">now get a list of all accesses</span>
    accessing = (db.accessdataset.id==db.accessrequest.accessdataset_id)&amp;(db.dataset.id==db.accessrequest.dataset_id)
    records = SQLTABLE(db(accessing).select(),headers=<span style="color: #2aa198;">'fieldname:capitalize'</span>)
    <span style="color: #859900; font-weight: bold;">return</span> dict(form=form, records=records)


</pre>




</div>

</div>

<div id="outline-container-6-4" class="outline-3">
<h3 id="sec-6-4"><span class="section-number-3">6.4</span> Main form ties it all together (manage projects)</h3>
<div class="outline-text-3" id="text-6-4">




<pre class="src src-R">def manage_projects():
    grid = SQLFORM.smartgrid(db.project,linked_tables=[<span style="color: #2aa198;">'dataset'</span>, <span style="color: #2aa198;">'entity'</span>, <span style="color: #2aa198;">'publication'</span>, <span style="color: #2aa198;">'intellectualright'</span>, <span style="color: #2aa198;">'attr'</span>,<span style="color: #2aa198;">'accessrequest'</span>, <span style="color: #2aa198;">'authorship_approval'</span>
                                                      ],
                             fields = [db.project.title, db.project.personnel_data_owner,
                                       db.dataset.shortname,


                                       db.dataset.additional_metadata,                                          

                                       db.entity.entityname, db.entity.entitydescription, db.entity.physical_distribution, 
                                       db.attr.variable_name, db.attr.variable_definition,
                                       db.accessrequest.accessdataset_id, 
                                       db.accessrequest.dataset_id,
                                       db.accessrequest.title, 

                                       db.intellectualright.licence_code,
                                       db.publication.bibtex_key, db.publication.title,  
                                       db.publication.google_scholar_cites, db.publication.impact_factor,
                                       db.authorship_approval.id, db.authorship_approval.name, db.authorship_approval.date_request_sent,
                                       db.authorship_approval.date_approval_given],
                                       orderby = dict(project=db.project.title, dataset=db.dataset.shortname,authorship_approval=db.authorship_approval.id),
                             user_signature=True,maxtextlength =200, csv=False, paginate=50)
    <span style="color: #859900; font-weight: bold;">return</span> dict(grid=grid)
</pre>



</div>

</div>

<div id="outline-container-6-5" class="outline-3">
<h3 id="sec-6-5"><span class="section-number-3">6.5</span> Form to manage all dataset</h3>
<div class="outline-text-3" id="text-6-5">


</div>

<div id="outline-container-6-5-1" class="outline-4">
<h4 id="sec-6-5-1"><span class="section-number-4">6.5.1</span> manage datasets</h4>
<div class="outline-text-4" id="text-6-5-1">




<pre class="src src-R">def manage_datasets():
    grid = SQLFORM.smartgrid(db.dataset,linked_tables=[ <span style="color: #2aa198;">'entity'</span>, <span style="color: #2aa198;">'keyword'</span>, <span style="color: #2aa198;">'intellectualright'</span>, <span style="color: #2aa198;">'attr'</span>,<span style="color: #2aa198;">'accessrequest'</span>, <span style="color: #2aa198;">'publication'</span>, <span style="color: #2aa198;">'authorship_approval'</span>
                                                      ],
                             fields = [
                                       db.dataset.shortname,
                                       db.dataset.id,
                            
                                       db.dataset.additional_metadata,                                          
                                       db.dataset.contact_email,
                                       db.entity.entityname, db.entity.entitydescription, db.entity.physical_distribution,
                                       db.attr.variable_name, db.attr.variable_definition,
                                       db.accessrequest.accessdataset_id, 
                                       db.accessrequest.dataset_id,
                                       db.accessrequest.title, 
                                       db.keyword.keyword,
                                       db.intellectualright.licence_code,
                                       db.publication.bibtex_key, db.publication.title,  
                                       db.publication.google_scholar_cites, db.publication.impact_factor,
                                       db.authorship_approval.id, db.authorship_approval.name, db.authorship_approval.date_request_sent,
                                       db.authorship_approval.date_approval_given],
                                       orderby = dict(dataset=db.dataset.title,authorship_approval=db.authorship_approval.id),
                             user_signature=True,maxtextlength =200, csv=False, paginate=50)
    <span style="color: #859900; font-weight: bold;">return</span> dict(grid=grid)
</pre>



</div>
</div>

</div>

<div id="outline-container-6-6" class="outline-3">
<h3 id="sec-6-6"><span class="section-number-3">6.6</span> test autoenter creator in contact FAIL</h3>
<div class="outline-text-3" id="text-6-6">




</div>

<div id="outline-container-6-6-1" class="outline-4">
<h4 id="sec-6-6-1"><span class="section-number-4">6.6.1</span> manage datasets test</h4>
<div class="outline-text-4" id="text-6-6-1">




<pre class="src src-R">def manage_datasets():
    grid = SQLFORM.smartgrid(db.dataset,linked_tables=[ <span style="color: #2aa198;">'entity'</span>, <span style="color: #2aa198;">'keyword'</span>, <span style="color: #2aa198;">'intellectualright'</span>, <span style="color: #2aa198;">'attr'</span>,<span style="color: #2aa198;">'accessrequest'</span>, <span style="color: #2aa198;">'publication'</span>, <span style="color: #2aa198;">'authorship_approval'</span>
                                                      ],
                             fields = [
                                       db.dataset.shortname,
                                       db.dataset.id,
                            
                                       db.dataset.additional_metadata,                                          
                                       db.dataset.contact_email,
                                       db.entity.entityname, db.entity.entitydescription, db.entity.physical_distribution,
                                       db.attr.variable_name, db.attr.variable_definition,
                                       db.accessrequest.accessdataset_id, 
                                       db.accessrequest.dataset_id,
                                       db.accessrequest.title, 
                                       db.keyword.keyword,
                                       db.intellectualright.licence_code,
                                       db.publication.bibtex_key, db.publication.title,  
                                       db.publication.google_scholar_cites, db.publication.impact_factor,
                                       db.authorship_approval.id, db.authorship_approval.name, db.authorship_approval.date_request_sent,
                                       db.authorship_approval.date_approval_given],
                                       orderby = dict(dataset=db.dataset.title,authorship_approval=db.authorship_approval.id),
                             user_signature=True,maxtextlength =200, csv=False, paginate=50)
    <span style="color: #859900; font-weight: bold;">if</span> grid.process(onvalidation=my_form_processing).accepted:
        session.flash = <span style="color: #2aa198;">'record inserted'</span>
        redirect(URL())

    <span style="color: #859900; font-weight: bold;">return</span> dict(grid=grid)
</pre>


</div>
</div>

</div>

<div id="outline-container-6-7" class="outline-3">
<h3 id="sec-6-7"><span class="section-number-3">6.7</span> Form to manage all publications</h3>
<div class="outline-text-3" id="text-6-7">




<pre class="src src-R">def manage_publications():
    grid = SQLFORM.smartgrid(db.publication,linked_tables=[<span style="color: #2aa198;">'publication'</span>, <span style="color: #2aa198;">'authorship_approval'</span>
                                                      ],
                             fields = [
                                       db.publication.bibtex_key, db.publication.citation,  
                                       db.publication.thesis_section, 
                                       db.authorship_approval.id, db.authorship_approval.name, db.authorship_approval.date_request_sent,
                                       db.authorship_approval.date_approval_given],
                                       orderby = dict(thesis_section=db.publication.thesis_section, authorship_approval=db.authorship_approval.id),
                             user_signature=True,maxtextlength =200)
    <span style="color: #859900; font-weight: bold;">return</span> dict(grid=grid)
</pre>



</div>

</div>

<div id="outline-container-6-8" class="outline-3">
<h3 id="sec-6-8"><span class="section-number-3">6.8</span> Form to manage accessors or groups</h3>
<div class="outline-text-3" id="text-6-8">





</div>

</div>

<div id="outline-container-6-9" class="outline-3">
<h3 id="sec-6-9"><span class="section-number-3">6.9</span> finesse the interface</h3>
<div class="outline-text-3" id="text-6-9">

<ul>
<li>the following makes a home page
</li>
<li>TODO the indenting is stuffed in the index chunk

</li>
<li>also go to static/css/web2py.css and change line 33/34 text width to about 800px
</li>
<li>removed from just above instructions and replaced with if auth is logged after instructions.
  {{if 'message' in globals():}}
  &lt;h3&gt;{{=message}}&lt;/h3&gt;

</li>
<li>removed from bottom
  {{block right<sub>sidebar</sub>}}
  {{<code>A(T("Administrative Interface"), _href=URL('admin','default','index'), _class</code>'btn',
       <sub>style</sub>='margin-top: 1em;')}}
  {{end}}
</li>
</ul>




<pre class="src src-markdown">  {{left<span style="color: #268bd2; font-style: italic;">_sidebar_</span>enabled,right<span style="color: #268bd2; font-style: italic;">_sidebar_</span>enabled=False,('message' in globals())}}
{{extend 'layout.html'}}
  

  &lt;h4&gt;{{=T('Instructions')}}&lt;/h4&gt;
  &lt;li&gt;{{=T('To use the data inventory please register in top right corner.')}}&lt;/li&gt;
  {{if auth.is<span style="color: #268bd2; font-style: italic;">_logged_</span>in():}}
&lt;ol&gt;
    &lt;li&gt;{{=T('You are using the data inventory')}}&lt;/li&gt;
  &lt;li&gt;{{=XML(T('The main tool for managing research projects (umbrella grouping of datasets) is at %s',
             A('%(application)s/forms/manage<span style="color: #268bd2; font-style: italic;">_projects/'%request,</span>
<span style="color: #268bd2; font-style: italic;">           _href=URL('forms','manage_</span>projects'))))}}&lt;/li&gt;
    &lt;li&gt;{{=XML(T('The main tool for managing datasets is at %s',
           A('%(application)s/forms/manage<span style="color: #268bd2; font-style: italic;">_datasets/'%request,</span>
<span style="color: #268bd2; font-style: italic;">             _href=URL('forms','manage_</span>datasets'))))}}&lt;/li&gt;
  &lt;li&gt;{{=XML(T('The technical documentation for this application is at %s',
             A('this link',
           <span style="color: #268bd2; font-style: italic;">_href=URL('static','index.html'), _target='new')))}}&lt;/li&gt;</span>
<span style="color: #268bd2; font-style: italic;">&lt;/ol&gt;</span>
<span style="color: #268bd2; font-style: italic;">  {{elif 'content' in globals():}}</span>
<span style="color: #268bd2; font-style: italic;">{{=content}}</span>
<span style="color: #268bd2; font-style: italic;">  {{else:}}</span>
<span style="color: #268bd2; font-style: italic;">{{=BEAUTIFY(response._</span>vars)}}
  {{pass}}

  {{block right_sidebar}}
{{=A(T("About this site"), _href=URL('static', 'index.html'), _class='btn',
       _style='margin-top: 1em;')}}
{{end}}
  
</pre>
















</div>
</div>

</div>

<div id="outline-container-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> backups</h2>
<div class="outline-text-2" id="text-7">





</div>

</div>

<div id="outline-container-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> ETL</h2>
<div class="outline-text-2" id="text-8">




</div>

<div id="outline-container-8-1" class="outline-3">
<h3 id="sec-8-1"><span class="section-number-3">8.1</span> summary of data for ETL</h3>
<div class="outline-text-3" id="text-8-1">




</div>

</div>

<div id="outline-container-8-2" class="outline-3">
<h3 id="sec-8-2"><span class="section-number-3">8.2</span> load transformed</h3>
<div class="outline-text-3" id="text-8-2">


</div>

</div>

<div id="outline-container-8-3" class="outline-3">
<h3 id="sec-8-3"><span class="section-number-3">8.3</span> summary of EML fields for projects/datasets</h3>
<div class="outline-text-3" id="text-8-3">


</div>

<div id="outline-container-8-3-1" class="outline-4">
<h4 id="sec-8-3-1"><span class="section-number-4">8.3.1</span> head</h4>
<div class="outline-text-4" id="text-8-3-1">


</div>

</div>

<div id="outline-container-8-3-2" class="outline-4">
<h4 id="sec-8-3-2"><span class="section-number-4">8.3.2</span> dataset overview</h4>
<div class="outline-text-4" id="text-8-3-2">


</div>

</div>

<div id="outline-container-8-3-3" class="outline-4">
<h4 id="sec-8-3-3"><span class="section-number-4">8.3.3</span> umbrella project</h4>
<div class="outline-text-4" id="text-8-3-3">


</div>

</div>

<div id="outline-container-8-3-4" class="outline-4">
<h4 id="sec-8-3-4"><span class="section-number-4">8.3.4</span> dataset overview</h4>
<div class="outline-text-4" id="text-8-3-4">



</div>

</div>

<div id="outline-container-8-3-5" class="outline-4">
<h4 id="sec-8-3-5"><span class="section-number-4">8.3.5</span> files entities overview</h4>
<div class="outline-text-4" id="text-8-3-5">


</div>

</div>

<div id="outline-container-8-3-6" class="outline-4">
<h4 id="sec-8-3-6"><span class="section-number-4">8.3.6</span> attributes</h4>
<div class="outline-text-4" id="text-8-3-6">


</div>
</div>

</div>

<div id="outline-container-8-4" class="outline-3">
<h3 id="sec-8-4"><span class="section-number-3">8.4</span> short summary of EML fields for projects/datasets homepage</h3>
<div class="outline-text-3" id="text-8-4">


</div>

<div id="outline-container-8-4-1" class="outline-4">
<h4 id="sec-8-4-1"><span class="section-number-4">8.4.1</span> head</h4>
<div class="outline-text-4" id="text-8-4-1">


</div>

</div>

<div id="outline-container-8-4-2" class="outline-4">
<h4 id="sec-8-4-2"><span class="section-number-4">8.4.2</span> dataset overview</h4>
<div class="outline-text-4" id="text-8-4-2">


</div>

</div>

<div id="outline-container-8-4-3" class="outline-4">
<h4 id="sec-8-4-3"><span class="section-number-4">8.4.3</span> umbrella project</h4>
<div class="outline-text-4" id="text-8-4-3">


</div>

</div>

<div id="outline-container-8-4-4" class="outline-4">
<h4 id="sec-8-4-4"><span class="section-number-4">8.4.4</span> dataset overview</h4>
<div class="outline-text-4" id="text-8-4-4">



</div>

</div>

<div id="outline-container-8-4-5" class="outline-4">
<h4 id="sec-8-4-5"><span class="section-number-4">8.4.5</span> files entities overview</h4>
<div class="outline-text-4" id="text-8-4-5">

<p>EML<sub>metadata</sub><sub>short</sub>.Rmd
</p>

</div>
</div>

</div>

<div id="outline-container-8-5" class="outline-3">
<h3 id="sec-8-5"><span class="section-number-3">8.5</span> data inventory report</h3>
<div class="outline-text-3" id="text-8-5">




</div>
</div>

</div>

<div id="outline-container-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> check in/check out</h2>
<div class="outline-text-2" id="text-9">


</div>

<div id="outline-container-9-1" class="outline-3">
<h3 id="sec-9-1"><span class="section-number-3">9.1</span> checkout from child to master when master not exists</h3>
<div class="outline-text-3" id="text-9-1">


</div>

</div>

<div id="outline-container-9-2" class="outline-3">
<h3 id="sec-9-2"><span class="section-number-3">9.2</span> checkout from master to child, assumes you want to replace child (and manually removed it)</h3>
<div class="outline-text-3" id="text-9-2">


</div>

</div>

<div id="outline-container-9-3" class="outline-3">
<h3 id="sec-9-3"><span class="section-number-3">9.3</span> DEPRECATED identify-aquire-post-update-review procedures</h3>
<div class="outline-text-3" id="text-9-3">

<ul>
<li>doco for identified data are in a sep database so not to mess up clean inventory
</li>
<li>once data aquisitioon has started transfer to the main data inventory
</li>
</ul>


</div>
</div>
</div>
</div>

</body>
</html>
